<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>title</title>
    <style>
        iframe {
            border: solid grey;
            border-width: 3px;
        }

        #main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #choice_div {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        .choice_btn {
            margin: 10px 10px 0px 10px;
            width: 5ch;
        }
    </style>
</head>
<body>
    <div style="display: flex;flex-direction: column;justify-items: center;">
        <div id="main">
        </div>
        <div id="choice_div">
        </div>
    </div>
    <script>
        const models = ["SN2_1", "SN2_1"];
        var cur = 0;
        var elms = [];

        function switch_img(i){
            i = Number(i);

            if (i == cur || i < 0 || i >= elms.length){
                return;
            }
            elms[cur].style.display = "none";
            elms[cur].contentWindow.main.paused = true;
            elms[i].style.display = "block";
            elms[i].focus();
            elms[i].contentWindow.main.start_loop();
            cur = i;
        }

        function lr_btn(code){
            if (code == "ArrowRight"){
                switch_img(cur+1);
            } else if (code == "ArrowLeft"){
                switch_img(cur-1);
            }
        }

        window.onload = () => {
            let main = document.getElementById("main");
            let done_prom = [];
            for (let i in models){
                let model = models[i];
                let frame = document.createElement("iframe");
                frame.src = "canvas.html";
                frame.id = "elm_" + model;
                frame.classList.add("my_iframe");
                main.appendChild(frame);
                elms.push(frame);
                frame.addEventListener("load", () => {
                    frame.contentWindow.init_frame(
                        window.innerWidth,
                        window.innerHeight
                    ).then((res) => {
                        frame.width = res.w;
                        frame.height = res.h;
                        frame.contentWindow.set_script(model + ".js").then((res) => {
                            if (i != cur){
                                frame.style.display = "none";
                                frame.contentWindow.main.paused = true;
                            } else {
                                frame.focus()
                            }
                        });
                    });
                });
                
                frame.contentWindow.addEventListener("keydown", (e) => {
                    lr_btn(e.code);
                })

                let btn = document.createElement("button");
                btn.innerHTML = i;
                btn.classList.add("choice_btn");
                btn.onclick = () => {switch_img(i);};
                document.getElementById("choice_div").appendChild(btn);
            }
            document.addEventListener("keydown", (e) => {
                e.preventDefault();
                lr_btn(e.code);
            });
        };
    </script>
</body>
</html>